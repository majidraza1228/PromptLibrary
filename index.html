<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Prompt Library</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%236c63ff'/><stop offset='100%25' style='stop-color:%2350c8f0'/></linearGradient></defs><rect width='100' height='100' rx='20' fill='%230f0f0f'/><text x='50' y='68' font-size='55' text-anchor='middle' font-family='serif' font-weight='bold' fill='url(%23g)'>PL</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f0f0f;
    --surface: #1a1a1a;
    --surface-2: #222222;
    --surface-3: #2a2a2a;
    --border: #333;
    --border-hover: #444;
    --text: #e8e8e8;
    --text-muted: #888;
    --text-dim: #555;
    --accent-writing: #f0a050;
    --accent-writing-bg: rgba(240,160,80,0.08);
    --accent-coding: #50c8f0;
    --accent-coding-bg: rgba(80,200,240,0.08);
    --accent-meta: #b080f0;
    --accent-meta-bg: rgba(176,128,240,0.08);
    --green: #50d080;
    --red: #f06060;
    --yellow: #f0d050;
    --radius: 10px;
    --radius-sm: 6px;
    --shadow: 0 2px 12px rgba(0,0,0,0.3);
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: 'Outfit', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* ── Sidebar ── */
  .layout {
    display: flex;
    min-height: 100vh;
  }

  .sidebar {
    width: 260px;
    background: var(--surface);
    border-right: 1px solid var(--border);
    padding: 28px 20px;
    position: fixed;
    top: 0; left: 0; bottom: 0;
    overflow-y: auto;
    z-index: 10;
  }

  .sidebar-logo {
    font-size: 15px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 6px;
  }

  .sidebar-title {
    font-family: 'Source Serif 4', serif;
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 28px;
    color: var(--text);
  }

  .sidebar-section {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 10px;
    margin-top: 24px;
  }

  .sidebar-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 14px;
    color: var(--text-muted);
    transition: all 0.15s;
    margin-bottom: 2px;
  }

  .sidebar-item:hover {
    background: var(--surface-2);
    color: var(--text);
  }

  .sidebar-item.active {
    background: var(--surface-3);
    color: var(--text);
    font-weight: 500;
  }

  .sidebar-item .icon { font-size: 16px; width: 20px; text-align: center; }
  .sidebar-item .count {
    margin-left: auto;
    font-size: 12px;
    color: var(--text-dim);
    font-family: 'JetBrains Mono', monospace;
  }

  .dot-writing { color: var(--accent-writing); }
  .dot-coding { color: var(--accent-coding); }
  .dot-meta { color: var(--accent-meta); }

  /* ── Main ── */
  .main {
    margin-left: 260px;
    flex: 1;
    padding: 36px 48px;
    max-width: 1100px;
  }

  /* ── Header ── */
  .page-header {
    margin-bottom: 32px;
  }

  .page-header h1 {
    font-family: 'Source Serif 4', serif;
    font-size: 32px;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .page-header p {
    color: var(--text-muted);
    font-size: 15px;
  }

  /* ── Search & Controls ── */
  .controls {
    display: flex;
    gap: 12px;
    margin-bottom: 28px;
    align-items: center;
    flex-wrap: wrap;
  }

  .search-box {
    flex: 1;
    min-width: 200px;
    position: relative;
  }

  .search-box input {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px 14px 10px 38px;
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .search-box input:focus { border-color: var(--text-dim); }
  .search-box input::placeholder { color: var(--text-dim); }

  .search-box::before {
    content: '\2315';
    position: absolute;
    left: 13px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-dim);
    font-size: 16px;
  }

  .filter-btn {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px 16px;
    color: var(--text-muted);
    font-family: 'Outfit', sans-serif;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .filter-btn:hover { border-color: var(--border-hover); color: var(--text); }
  .filter-btn.active { border-color: var(--accent-writing); color: var(--accent-writing); background: var(--accent-writing-bg); }
  .filter-btn.active-code { border-color: var(--accent-coding); color: var(--accent-coding); background: var(--accent-coding-bg); }
  .filter-btn.active-meta { border-color: var(--accent-meta); color: var(--accent-meta); background: var(--accent-meta-bg); }

  .add-btn {
    background: var(--surface-3);
    border: 1px dashed var(--border);
    border-radius: var(--radius);
    padding: 10px 18px;
    color: var(--text-muted);
    font-family: 'Outfit', sans-serif;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .add-btn:hover { border-color: var(--green); color: var(--green); }

  /* ── Stats Bar ── */
  .stats-bar {
    display: flex;
    gap: 24px;
    margin-bottom: 28px;
    padding: 16px 20px;
    background: var(--surface);
    border-radius: var(--radius);
    border: 1px solid var(--border);
  }

  .stat {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 20px;
    font-weight: 600;
  }

  .stat-label {
    font-size: 12px;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* ── Prompt Cards ── */
  .prompts-grid {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .prompt-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px 24px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }

  .prompt-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 3px;
  }

  .prompt-card.cat-writing::before { background: var(--accent-writing); }
  .prompt-card.cat-coding::before { background: var(--accent-coding); }
  .prompt-card.cat-meta::before { background: var(--accent-meta); }

  .prompt-card:hover {
    border-color: var(--border-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow);
  }

  .prompt-card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 8px;
  }

  .prompt-card-title {
    font-size: 16px;
    font-weight: 600;
  }

  .prompt-card-meta {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-shrink: 0;
  }

  .tag {
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 4px;
    font-weight: 500;
    letter-spacing: 0.3px;
  }

  .tag-writing { background: var(--accent-writing-bg); color: var(--accent-writing); }
  .tag-coding { background: var(--accent-coding-bg); color: var(--accent-coding); }
  .tag-meta { background: var(--accent-meta-bg); color: var(--accent-meta); }

  .rating {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: var(--yellow);
  }

  .prompt-card-desc {
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 12px;
    line-height: 1.5;
  }

  .prompt-card-footer {
    display: flex;
    gap: 16px;
    align-items: center;
    font-size: 12px;
    color: var(--text-dim);
  }

  .prompt-card-footer span {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .fav-star {
    cursor: pointer;
    font-size: 14px;
    transition: transform 0.2s;
    user-select: none;
  }

  .fav-star:hover { transform: scale(1.3); }
  .fav-star.active { color: var(--yellow); }

  /* ── Expanded prompt ── */
  .prompt-expanded {
    display: none;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
  }

  .prompt-expanded.show { display: block; }

  .prompt-text {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 16px 18px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    line-height: 1.7;
    color: var(--text);
    white-space: pre-wrap;
    word-break: break-word;
    position: relative;
    margin-bottom: 12px;
  }

  .prompt-text .var {
    color: var(--accent-writing);
    background: var(--accent-writing-bg);
    padding: 1px 4px;
    border-radius: 3px;
  }

  .copy-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 5px 10px;
    color: var(--text-muted);
    font-size: 11px;
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
    transition: all 0.15s;
  }

  .copy-btn:hover { color: var(--green); border-color: var(--green); }

  .example-output {
    margin-top: 12px;
  }

  .example-output summary {
    font-size: 13px;
    color: var(--text-muted);
    cursor: pointer;
    font-weight: 500;
  }

  .example-output-content {
    margin-top: 8px;
    padding: 14px;
    background: var(--surface-2);
    border-radius: var(--radius-sm);
    font-size: 13px;
    color: var(--text-muted);
    line-height: 1.6;
  }

  .prompt-notes {
    margin-top: 10px;
    font-size: 13px;
    color: var(--text-dim);
    font-style: italic;
  }

  /* ── Modal ── */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 100;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay.show { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 32px;
    width: 560px;
    max-width: 90vw;
    max-height: 85vh;
    overflow-y: auto;
  }

  .modal h2 {
    font-family: 'Source Serif 4', serif;
    font-size: 22px;
    margin-bottom: 20px;
  }

  .form-group {
    margin-bottom: 16px;
  }

  .form-group label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-muted);
    margin-bottom: 6px;
  }

  .form-group input,
  .form-group textarea,
  .form-group select {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 10px 14px;
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .form-group textarea {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    min-height: 120px;
    resize: vertical;
    line-height: 1.6;
  }

  .form-group input:focus,
  .form-group textarea:focus,
  .form-group select:focus {
    border-color: var(--text-dim);
  }

  .form-row {
    display: flex;
    gap: 12px;
  }

  .form-row .form-group { flex: 1; }

  .modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
  }

  .btn {
    padding: 10px 20px;
    border-radius: var(--radius-sm);
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border: 1px solid var(--border);
    transition: all 0.15s;
  }

  .btn-ghost {
    background: transparent;
    color: var(--text-muted);
  }

  .btn-ghost:hover { color: var(--text); }

  .btn-primary {
    background: var(--green);
    color: var(--bg);
    border-color: var(--green);
  }

  .btn-primary:hover { opacity: 0.9; }

  /* ── Best Practices Panel ── */
  .best-practices {
    margin-top: 40px;
    padding: 24px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
  }

  .best-practices h2 {
    font-family: 'Source Serif 4', serif;
    font-size: 20px;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .bp-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }

  .bp-card {
    padding: 14px 16px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
  }

  .bp-card h4 {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .bp-card p {
    font-size: 12px;
    color: var(--text-muted);
    line-height: 1.5;
  }

  /* ── Empty State ── */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-dim);
  }

  .empty-state .icon { font-size: 40px; margin-bottom: 12px; }
  .empty-state p { font-size: 14px; }

  /* ── Mobile Menu Toggle ── */
  .mobile-menu-btn {
    display: none;
    position: fixed;
    top: 16px;
    left: 16px;
    z-index: 20;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 8px 12px;
    color: var(--text);
    font-size: 18px;
    cursor: pointer;
  }

  /* ── Responsive ── */
  @media (max-width: 768px) {
    .sidebar {
      transform: translateX(-100%);
      transition: transform 0.3s;
    }
    .sidebar.open {
      transform: translateX(0);
    }
    .mobile-menu-btn { display: block; }
    .main { margin-left: 0; padding: 60px 20px 20px; }
    .bp-grid { grid-template-columns: 1fr; }
    .form-row { flex-direction: column; }
  }

  /* scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
</style>
</head>
<body>

<button class="mobile-menu-btn" onclick="toggleSidebar()">&#9776;</button>

<div class="layout">
  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-logo">&#128218; Personal</div>
    <div class="sidebar-title">Prompt Library</div>

    <div class="sidebar-section">Views</div>
    <div class="sidebar-item active" onclick="filterCategory('all', this)">
      <span class="icon">&#9643;</span> All Prompts <span class="count" id="count-all">20</span>
    </div>
    <div class="sidebar-item" onclick="filterCategory('favorite', this)">
      <span class="icon">&#9733;</span> Favorites <span class="count" id="count-fav">0</span>
    </div>

    <div class="sidebar-section">Categories</div>
    <div class="sidebar-item" onclick="filterCategory('writing', this)">
      <span class="icon dot-writing">&#9679;</span> Writing & Content <span class="count" id="count-writing">0</span>
    </div>
    <div class="sidebar-item" onclick="filterCategory('coding', this)">
      <span class="icon dot-coding">&#9679;</span> Coding & Dev <span class="count" id="count-coding">0</span>
    </div>
    <div class="sidebar-item" onclick="filterCategory('meta', this)">
      <span class="icon dot-meta">&#9679;</span> Meta / Prompt Eng <span class="count" id="count-meta">0</span>
    </div>

    <div class="sidebar-section">Quick Actions</div>
    <div class="sidebar-item" onclick="openModal()">
      <span class="icon">&#65291;</span> New Prompt
    </div>
    <div class="sidebar-item" onclick="exportLibrary()">
      <span class="icon">&#8595;</span> Export as Markdown
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main">
    <div class="page-header">
      <h1 id="page-title">All Prompts</h1>
      <p id="page-desc">Your curated collection of reusable, high-quality prompts</p>
    </div>

    <!-- Stats -->
    <div class="stats-bar">
      <div class="stat">
        <span class="stat-value" id="stat-total">0</span>
        <span class="stat-label">Total Prompts</span>
      </div>
      <div class="stat">
        <span class="stat-value" style="color:var(--accent-writing)" id="stat-writing">0</span>
        <span class="stat-label">Writing</span>
      </div>
      <div class="stat">
        <span class="stat-value" style="color:var(--accent-coding)" id="stat-coding">0</span>
        <span class="stat-label">Coding</span>
      </div>
      <div class="stat">
        <span class="stat-value" style="color:var(--accent-meta)" id="stat-meta">0</span>
        <span class="stat-label">Meta</span>
      </div>
      <div class="stat">
        <span class="stat-value" style="color:var(--yellow)" id="stat-favs">0</span>
        <span class="stat-label">Favorites</span>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls">
      <div class="search-box">
        <input type="text" placeholder="Search prompts, tags, descriptions..." id="search-input" oninput="renderPrompts()">
      </div>
      <button class="add-btn" onclick="openModal()">&#65291; Add Prompt</button>
    </div>

    <!-- Prompts List -->
    <div class="prompts-grid" id="prompts-grid"></div>

    <!-- Best Practices -->
    <div class="best-practices" id="best-practices-section">
      <h2>Prompt Engineering Best Practices</h2>
      <div class="bp-grid">
        <div class="bp-card">
          <h4>Be Specific with Role & Context</h4>
          <p>Start with "You are a [role] who [context]". The clearer the persona and situation, the better the output.</p>
        </div>
        <div class="bp-card">
          <h4>Use [Variables] for Reusability</h4>
          <p>Wrap swappable parts in [brackets]. This turns a one-off prompt into a reusable template you can deploy in seconds.</p>
        </div>
        <div class="bp-card">
          <h4>Show, Don't Just Tell</h4>
          <p>Include 1-2 examples of desired output. Few-shot examples dramatically improve consistency and quality.</p>
        </div>
        <div class="bp-card">
          <h4>Version & Iterate</h4>
          <p>Rate each prompt after use (1-10). Refine top performers, retire weak ones. Your library should evolve monthly.</p>
        </div>
        <div class="bp-card">
          <h4>Constrain the Output</h4>
          <p>Specify format, length, tone, and structure. "Write a 3-paragraph blog intro in a conversational tone" beats "Write about X".</p>
        </div>
        <div class="bp-card">
          <h4>Test Across Models</h4>
          <p>Tag which AI model works best for each prompt. Claude excels at nuance, GPT at breadth, Gemini at multimodal.</p>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Add/Edit Modal -->
<div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <h2 id="modal-title">Add New Prompt</h2>
    <div class="form-group">
      <label>Prompt Name</label>
      <input type="text" id="f-name" placeholder="e.g. Blog Post Outline Generator">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Category</label>
        <select id="f-category">
          <option value="writing">Writing & Content</option>
          <option value="coding">Coding & Dev</option>
          <option value="meta">Meta / Prompt Eng</option>
        </select>
      </div>
      <div class="form-group">
        <label>Best Model</label>
        <select id="f-model">
          <option value="Claude">Claude</option>
          <option value="GPT-4o">GPT-4o</option>
          <option value="Gemini">Gemini</option>
          <option value="Any">Any</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label>Description</label>
      <input type="text" id="f-desc" placeholder="Short description of what this prompt does">
    </div>
    <div class="form-group">
      <label>Prompt Template (use [VARIABLE] for placeholders)</label>
      <textarea id="f-prompt" placeholder="You are a [ROLE] specializing in [DOMAIN]. Your task is to..."></textarea>
    </div>
    <div class="form-group">
      <label>Tags (comma-separated)</label>
      <input type="text" id="f-tags" placeholder="e.g. blog, outline, content-strategy">
    </div>
    <div class="form-group">
      <label>Notes / Tips</label>
      <input type="text" id="f-notes" placeholder="Optional: when to use, what to watch for">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Rating (1-10)</label>
        <input type="number" id="f-rating" min="1" max="10" value="7">
      </div>
      <div class="form-group">
        <label>Version</label>
        <input type="text" id="f-version" value="1.0">
      </div>
    </div>
    <input type="hidden" id="f-edit-index" value="-1">
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="savePrompt()">Save Prompt</button>
    </div>
  </div>
</div>

<script src="prompts.js"></script>
<script>
// App logic — seed data is loaded from prompts.js

let prompts = [];
let currentFilter = 'all';

function init() {
  const stored = localStorage.getItem('prompt-library-v1');
  if (stored) {
    try { prompts = JSON.parse(stored); } catch(e) { prompts = [...seedPrompts]; }
  } else {
    prompts = [...seedPrompts];
  }
  updateCounts();
  renderPrompts();
}

function save() {
  localStorage.setItem('prompt-library-v1', JSON.stringify(prompts));
}

function updateCounts() {
  const writing = prompts.filter(p => p.category === 'writing').length;
  const coding = prompts.filter(p => p.category === 'coding').length;
  const meta = prompts.filter(p => p.category === 'meta').length;
  const favs = prompts.filter(p => p.favorite).length;

  document.getElementById('count-all').textContent = prompts.length;
  document.getElementById('count-writing').textContent = writing;
  document.getElementById('count-coding').textContent = coding;
  document.getElementById('count-meta').textContent = meta;
  document.getElementById('count-fav').textContent = favs;

  document.getElementById('stat-total').textContent = prompts.length;
  document.getElementById('stat-writing').textContent = writing;
  document.getElementById('stat-coding').textContent = coding;
  document.getElementById('stat-meta').textContent = meta;
  document.getElementById('stat-favs').textContent = favs;
}

function filterCategory(cat, el) {
  currentFilter = cat;
  document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
  if (el) el.classList.add('active');

  const titles = {
    all: 'All Prompts',
    favorite: 'Favorites',
    writing: 'Writing & Content',
    coding: 'Coding & Dev',
    meta: 'Meta / Prompt Engineering'
  };
  document.getElementById('page-title').textContent = titles[cat] || 'All Prompts';
  renderPrompts();
}

function getFilteredPrompts() {
  const search = document.getElementById('search-input').value.toLowerCase();
  return prompts.filter(p => {
    if (currentFilter === 'favorite' && !p.favorite) return false;
    if (currentFilter !== 'all' && currentFilter !== 'favorite' && p.category !== currentFilter) return false;
    if (search) {
      const haystack = `${p.name} ${p.description} ${p.tags.join(' ')} ${p.prompt}`.toLowerCase();
      if (!haystack.includes(search)) return false;
    }
    return true;
  });
}

function renderPrompts() {
  const grid = document.getElementById('prompts-grid');
  const filtered = getFilteredPrompts();

  if (filtered.length === 0) {
    grid.innerHTML = `<div class="empty-state"><div class="icon">No results</div><p>No prompts found. Try a different search or filter.</p></div>`;
    return;
  }

  grid.innerHTML = filtered.map((p, i) => {
    const realIndex = prompts.indexOf(p);
    const catClass = `cat-${p.category}`;
    const tagClass = `tag-${p.category}`;
    const stars = '\u2605'.repeat(Math.round(p.rating / 2)) + '\u2606'.repeat(5 - Math.round(p.rating / 2));
    const promptHtml = p.prompt.replace(/\[([A-Z_\/]+)\]/g, '<span class="var">[$1]</span>');

    return `
      <div class="prompt-card ${catClass}" onclick="toggleExpand(this)">
        <div class="prompt-card-header">
          <div class="prompt-card-title">${p.name}</div>
          <div class="prompt-card-meta">
            <span class="tag ${tagClass}">${p.category}</span>
            <span class="rating">${stars}</span>
            <span class="fav-star ${p.favorite ? 'active' : ''}" onclick="event.stopPropagation();toggleFav(${realIndex})">
              ${p.favorite ? '\u2605' : '\u2606'}
            </span>
          </div>
        </div>
        <div class="prompt-card-desc">${p.description}</div>
        <div class="prompt-card-footer">
          <span>${p.model}</span>
          <span>v${p.version}</span>
          <span>${p.created}</span>
          <span>${p.uses || 0} uses</span>
          <span>${p.tags.map(t => '#' + t).join(' ')}</span>
        </div>
        <div class="prompt-expanded" id="exp-${realIndex}">
          <div class="prompt-text">
            <button class="copy-btn" onclick="event.stopPropagation();copyPrompt(${realIndex})">Copy</button>
            ${promptHtml}
          </div>
          ${p.notes ? `<div class="prompt-notes">${p.notes}</div>` : ''}
          <div style="margin-top:12px;display:flex;gap:8px;">
            <button class="btn btn-ghost" style="font-size:12px;padding:6px 12px;" onclick="event.stopPropagation();editPrompt(${realIndex})">Edit</button>
            <button class="btn btn-ghost" style="font-size:12px;padding:6px 12px;color:var(--red);" onclick="event.stopPropagation();deletePrompt(${realIndex})">Delete</button>
          </div>
        </div>
      </div>`;
  }).join('');
}

function toggleExpand(card) {
  const exp = card.querySelector('.prompt-expanded');
  exp.classList.toggle('show');
}

function toggleFav(i) {
  prompts[i].favorite = !prompts[i].favorite;
  save();
  updateCounts();
  renderPrompts();
}

function copyPrompt(i) {
  navigator.clipboard.writeText(prompts[i].prompt);
  const btns = document.querySelectorAll('.copy-btn');
  btns.forEach(b => {
    if (b.closest('.prompt-expanded')?.id === `exp-${i}`) {
      b.textContent = 'Copied!';
      setTimeout(() => b.textContent = 'Copy', 1500);
    }
  });
}

function openModal() {
  document.getElementById('modal-overlay').classList.add('show');
  document.getElementById('modal-title').textContent = 'Add New Prompt';
  document.getElementById('f-edit-index').value = -1;
  clearForm();
}

function closeModal() {
  document.getElementById('modal-overlay').classList.remove('show');
}

function clearForm() {
  ['f-name','f-desc','f-prompt','f-tags','f-notes'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('f-category').value = 'writing';
  document.getElementById('f-model').value = 'Claude';
  document.getElementById('f-rating').value = 7;
  document.getElementById('f-version').value = '1.0';
}

function editPrompt(i) {
  const p = prompts[i];
  document.getElementById('f-name').value = p.name;
  document.getElementById('f-category').value = p.category;
  document.getElementById('f-model').value = p.model;
  document.getElementById('f-desc').value = p.description;
  document.getElementById('f-prompt').value = p.prompt;
  document.getElementById('f-tags').value = p.tags.join(', ');
  document.getElementById('f-notes').value = p.notes || '';
  document.getElementById('f-rating').value = p.rating;
  document.getElementById('f-version').value = p.version;
  document.getElementById('f-edit-index').value = i;
  document.getElementById('modal-title').textContent = 'Edit Prompt';
  document.getElementById('modal-overlay').classList.add('show');
}

function savePrompt() {
  const name = document.getElementById('f-name').value.trim();
  const prompt = document.getElementById('f-prompt').value.trim();
  if (!name || !prompt) { alert('Name and Prompt are required.'); return; }

  const data = {
    name,
    category: document.getElementById('f-category').value,
    description: document.getElementById('f-desc').value.trim(),
    prompt,
    tags: document.getElementById('f-tags').value.split(',').map(t => t.trim()).filter(Boolean),
    model: document.getElementById('f-model').value,
    rating: parseInt(document.getElementById('f-rating').value) || 7,
    version: document.getElementById('f-version').value || '1.0',
    notes: document.getElementById('f-notes').value.trim(),
    favorite: false,
    uses: 0,
    created: new Date().toISOString().slice(0, 10)
  };

  const editIndex = parseInt(document.getElementById('f-edit-index').value);
  if (editIndex >= 0) {
    data.favorite = prompts[editIndex].favorite;
    data.uses = prompts[editIndex].uses;
    data.created = prompts[editIndex].created;
    prompts[editIndex] = data;
  } else {
    prompts.unshift(data);
  }

  save();
  updateCounts();
  renderPrompts();
  closeModal();
}

function deletePrompt(i) {
  if (confirm(`Delete "${prompts[i].name}"?`)) {
    prompts.splice(i, 1);
    save();
    updateCounts();
    renderPrompts();
  }
}

function exportLibrary() {
  let md = `# My Prompt Library\n\n`;
  md += `> Exported on ${new Date().toLocaleDateString()} — ${prompts.length} prompts\n\n---\n\n`;

  const categories = { writing: 'Writing & Content', coding: 'Coding & Dev', meta: 'Meta / Prompt Engineering' };

  Object.entries(categories).forEach(([key, label]) => {
    const catPrompts = prompts.filter(p => p.category === key);
    if (catPrompts.length === 0) return;

    md += `## ${label}\n\n`;
    catPrompts.forEach(p => {
      md += `### ${p.name} ${p.favorite ? '(Favorite)' : ''}\n\n`;
      md += `- **Rating**: ${p.rating}/10 | **Model**: ${p.model} | **Version**: ${p.version} | **Uses**: ${p.uses}\n`;
      md += `- **Tags**: ${p.tags.map(t => '`' + t + '`').join(' ')}\n`;
      md += `- **Description**: ${p.description}\n`;
      if (p.notes) md += `- **Notes**: ${p.notes}\n`;
      md += `\n\`\`\`\n${p.prompt}\n\`\`\`\n\n---\n\n`;
    });
  });

  const blob = new Blob([md], { type: 'text/markdown' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'prompt-library.md';
  a.click();
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
}

// Init
init();
</script>
</body>
</html>
